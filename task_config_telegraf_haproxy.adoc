---
sidebar: sidebar 
permalink: task_config_telegraf_haproxy.html 
keywords: telegraf, installation, install, haproxy 
summary: Configuration du collecteur de données HAProxy 
---
= Collecteur de données HAProxy
:hardbreaks:
:allow-uri-read: 


[role="lead"]
Data Infrastructure Insights utilise ce collecteur de données pour collecter des métriques à partir de HAProxy.



== Installation

. Depuis *Observabilité > Collecteurs*, cliquez sur *+Collecteur de données*.  Choisissez HAProxy.
+
Sélectionnez le système d’exploitation ou la plate-forme sur laquelle l’agent Telegraf est installé.

. Si vous n'avez pas encore installé d'agent pour la collecte, ou si vous souhaitez installer un agent pour un autre système d'exploitation ou une autre plate-forme, cliquez sur _Afficher les instructions_ pour développer lelink:task_config_telegraf_agent.html["Installation de l'agent"] instructions.
. Sélectionnez la clé d’accès de l’agent à utiliser avec ce collecteur de données.  Vous pouvez ajouter une nouvelle clé d'accès d'agent en cliquant sur le bouton *+ Clé d'accès d'agent*.  Meilleure pratique : utilisez une clé d’accès d’agent différente uniquement lorsque vous souhaitez regrouper des collecteurs de données, par exemple par système d’exploitation/plateforme.
. Suivez les étapes de configuration pour configurer le collecteur de données.  Les instructions varient en fonction du type de système d’exploitation ou de plate-forme que vous utilisez pour collecter des données.


image:HAProxyDCConfigLinux.png["Configuration de HAProxy"]



== Installation

Le plugin de Telegraf pour HAProxy repose sur l'activation de HAProxy Stats.  Il s'agit d'une configuration intégrée à HAProxy, mais elle n'est pas activée par défaut.  Lorsqu'il est activé, HAProxy exposera un point de terminaison HTML qui peut être visualisé sur votre navigateur ou récupéré pour l'extraction de l'état de toutes les configurations HAProxy.



=== Compatibilité:

La configuration a été développée par rapport à la version HAProxy 1.9.4.



=== Installation :

Pour activer les statistiques, modifiez votre fichier de configuration haproxy et ajoutez les lignes suivantes après la section « defaults », en utilisant votre propre nom d'utilisateur/mot de passe et/ou URL haproxy :

[listing]
----
stats enable
stats auth myuser:mypassword
stats uri  /haproxy?stats
----
Voici un exemple simplifié de fichier de configuration avec les statistiques activées :

[listing]
----
global
  daemon
  maxconn 256

defaults
  mode http
  stats enable
  stats uri /haproxy?stats
  stats auth myuser:mypassword
  timeout connect 5000ms
  timeout client 50000ms
  timeout server 50000ms

frontend http-in
  bind *:80
  default_backend servers

frontend http-in9080
  bind *:9080
  default_backend servers_2

backend servers
  server server1 10.128.0.55:8080 check ssl verify none
  server server2 10.128.0.56:8080 check ssl verify none

backend servers_2
  server server3 10.128.0.57:8080 check ssl verify none
  server server4 10.128.0.58:8080 check ssl verify none
----
Pour des instructions complètes et à jour, consultez lelink:https://cbonte.github.io/haproxy-dconv/1.8/configuration.html#4-stats%20enable["Documentation HAProxy"] .



== Objets et compteurs

Les objets suivants et leurs compteurs sont collectés :

[cols="<.<,<.<,<.<,<.<"]
|===
| Objet: | Identifiants : | Attributs: | Points de données : 


| Interface HAProxy | Proxy d'adresse d'espace de noms | Nœud IP Nom du nœud ID proxy Mode ID de processus Limite de débit de sessions ID du serveur Limite de sessions Statut | Octets entrants Octets sortants Accès au cache Recherches dans le cache Compression Octets contournés Compression Octets entrants Compression Octets sortants Réponses Taux de connexion Taux de connexion Nombre maximal de connexions Nombre total de requêtes refusées par la règle de connexion Requêtes refusées par des problèmes de sécurité Réponses refusées par des problèmes de sécurité Requêtes refusées par la règle de session Erreurs de requêtes Réponses Réponses 1xx Réponses 2xx Réponses 3xx Réponses 4xx Réponses 5xx Autres requêtes Sessions interceptées Taux Sessions Taux Max Requêtes Taux Requêtes Taux Max Requêtes Total Sessions Sessions Max Sessions Total Requêtes Réécritures 


| Serveur HAProxy | Serveur proxy d'adresse d'espace de noms | Nœud IP Nom du nœud Heure de fin de vérification Configuration de chute Vérification de la valeur d'intégrité Vérification de la configuration de montée Statut ID proxy Heure de la dernière modification Heure de la dernière session Mode ID de processus ID du serveur Statut Poids | Serveurs actifs Serveurs de sauvegarde Octets entrants Octets sortants Vérifications échouées Abandons de vérification Client Connexions Temps moyen de connexion Temps d'arrêt Total des réponses refusées Erreurs de connexion Erreurs de réponse Réponses 1xx Réponses 2xx Réponses 3xx Réponses 4xx Réponses 5xx Autre serveur sélectionné File d'attente totale File d'attente actuelle Temps moyen maximal de la file d'attente Sessions par seconde Sessions par seconde Temps de réponse maximal de réutilisation de connexion Moyenne Sessions Sessions Transfert de serveur max. Abandons Sessions Total des sessions Temps total Moyenne des requêtes Redispatches Requêtes Nouvelles tentatives Requêtes Réécritures 


| Backend HAProxy | Proxy d'adresse d'espace de noms | Nœud IP Nom du nœud ID proxy Heure de la dernière modification Heure de la dernière session Mode ID du processus ID du serveur Limite de sessions Statut Poids | Serveurs actifs Serveurs de sauvegarde Octets entrants Octets sortants Accès au cache Consultations dans le cache Vérifications Abandons client Compression Octets contournés Compression Octets entrants Compression Octets sortants Réponses Connexions Temps moyen de connexion Temps d'arrêt Total des requêtes refusées pour des raisons de sécurité Réponses refusées pour des raisons de sécurité Erreurs de connexion Erreurs de réponse Réponses 1xx Réponses 2xx Réponses 3xx Réponses 4xx Réponses 5xx Autre serveur sélectionné File d'attente totale File d'attente actuelle Temps moyen de file d'attente Sessions par seconde Sessions par seconde Nombre maximal de requêtes Réutilisation totale des connexions Temps de réponse moyen Sessions Sessions Nombre maximal d'abandons de transfert de serveur Sessions Total des sessions Temps total Moyenne des requêtes Redispatches Requêtes Nouvelles tentatives Requêtes Réécritures 
|===


== Dépannage

Des informations complémentaires peuvent être trouvées à partir dulink:concept_requesting_support.html["Support"] page.
