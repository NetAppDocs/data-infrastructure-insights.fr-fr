---
sidebar: sidebar 
permalink: task_install_manual_au.html 
keywords: Acquisition Unit, AU, install, configure, Linux, add, remove, uninstall, delete, deleting, move, moving, manual, AU, Patch 
summary: Data Infrastructure Insights peut être configuré pour que le logiciel AU soit mis à jour manuellement, offrant ainsi plus de contrôle sur le logiciel installé sur votre locataire. 
---
= Installation manuelle du logiciel de l'unité d'acquisition
:hardbreaks:
:allow-uri-read: 


[role="lead"]
Par défaut, Data Infrastructure Insights met à jour automatiquement le logiciel de l'unité d'acquisition (AU) à mesure que les mises à jour sont déployées.  Cependant, dans des environnements contrôlés et sécurisés, la mise à jour automatique peut ne pas être possible ou souhaitée.  Dans ces cas, Data Infrastructure Insights peut être configuré pour que le logiciel AU soit mis à jour manuellement, offrant ainsi plus de contrôle sur le logiciel installé sur votre locataire.

Pour télécharger et installer manuellement le logiciel AU, procédez comme suit.  Data Infrastructure Insights fournit une page de documentation Swagger utile que vous pouvez utiliser pour bon nombre de ces étapes, ou vous pouvez utiliser votre propre script/commandes API.  Accédez à Admin > Accès API et cliquez sur le lien « Documentation API ».

Le processus est similaire pour Linux et Windows.



== Effectuer une NOUVELLE installation AU sous Linux :

. Dans Data Infrastructure Insights, créez un jeton API.
+
.. Accédez à *Admin > Accès API* et sélectionnez *+Jeton d’accès API*.
+
... Définissez un *Nom* et une *Description* faciles à identifier
... Type : Choisissez *Unité d'acquisition* et *Collecte de données*
... Autorisations : *Lecture/Écriture*
... Sélectionnez les valeurs d'*Expiration* et de *Renouvellement automatique* souhaitées


.. Cliquez sur *Enregistrer*
.. Copiez le jeton d’accès API généré.  Cette étape doit être effectuée avant de pouvoir fermer la fenêtre.




image:Manual_AU_Create_API_Token.png["Créer un jeton API"]

. Dans Swagger (Admin > Accès API > Documentation API), utilisez le jeton pour autoriser les API Data Infrastructure Insights
+
.. Cliquez sur _Autoriser_ en haut à droite de l'écran Swagger
.. Collez le jeton copié ci-dessus dans le champ Clé API client
.. Cliquez sur *Autoriser*
.. Fermer la fenêtre




image:Manual_AU_Authorization.png["Autoriser le jeton API"]

. Téléchargez le programme d'installation AU à l'aide de l'API _/au/installers/{platform}/latest_ ou _/au/installers/{platform}/{version}_ :
+
.. Plateforme : *linux*
.. Version : *<version>* (la plus récente ou spécifiée)




image:Manual_AU_API_Retrieve_latest.png["API pour récupérer la dernière version AU"]


NOTE: Si vous ne téléchargez pas la dernière version, confirmez auprès de NetApp la version AU à spécifier pour le téléchargement.

. Cliquez sur *Télécharger le fichier*.  Si vous effectuez ces étapes sur un système autre que le système AU, copiez le fichier téléchargé sur le système AU.
. Alternativement, vous pouvez exécuter la commande CURL résultante sur le système AU :
+
 curl -X GET "<tenant>/rest/v1/au/installers/linux/<AU version>" -H "accept: application/octet-stream" -H "X-CloudInsights-ApiKey: <token>"
. À ce stade, le fichier d’installation doit être présent sur le système AU.



IMPORTANT: Les étapes suivantes nécessitent l’utilisation d’un jeton temporaire.  N'utilisez pas le jeton d'accès API que vous avez créé ci-dessus.

. Dans l'API Swagger de Data Infrastructure Insights , créez un jeton unique à l'aide de l'API _/au/oneTimeToken_.
+
.. Copiez le jeton à usage unique résultant.




image:Manual_AU_one_time_token.png["Créer un jeton API à usage unique"] image:Manual_AU_one_time_token_response.png["Réponse à un exemple de jeton API à usage unique"]

. Sur la machine sur laquelle l'AU va être installé, accédez au dossier contenant le fichier d'installation téléchargé.  Les commandes ci-dessous nécessitent que l'utilisateur dispose des autorisations root.
+
.. Décompressez le fichier d'installation
.. Changer de répertoire vers le dossier d'installation résultant
.. Exportez le jeton à usage unique et la version du programme d’installation vers les variables d’environnement en exécutant la commande suivante :
+
 export TOKEN=<One-Time Token>
.. Exécutez ce qui suit pour installer CI avec un utilisateur et un groupe personnalisés :
+
 ./cloudinsights-install.sh <custom user> <custom group>
+
Remarque : si vous ne souhaitez pas utiliser d’utilisateur et de groupe personnalisés, vous pouvez utiliser l’utilisateur et le groupe « cisys » par défaut.  Dans ce cas, exécutez la commande d’installation ci-dessus mais ne spécifiez pas l’utilisateur et le groupe.





À ce stade, le logiciel AU est installé sur le système et est accessible par l’utilisateur et le groupe personnalisés.  Cependant, vous n'avez pas la possibilité d'ajouter des collecteurs de données.  Pour le faire manuellement, lisez les instructions suivantes.  Si vous souhaitez uniquement installer un correctif, consultez le<<downloading-a-patch,Correctif>> section ci-dessous.



== Installation manuelle des collecteurs de données

Téléchargez la dernière version de datasources.war à l'aide de l'API /collector/patch/datasourceswar/latest :

image:API_Manual_Download_datasources.png["API pour récupérer les dernières sources de données.war"]

Remarque : si vous ne téléchargez pas la dernière version, confirmez auprès de NetApp la version à spécifier pour le téléchargement.

Cliquez sur Télécharger le fichier.  Si vous effectuez ces étapes sur un système autre que le système AU, copiez le fichier zip datasources.war téléchargé sur le système AU.

Assurez-vous que le fichier zip datasources.war est copié dans le répertoire suivant : /var/lib/netapp/cloudinsights/acq/download

Accédez au répertoire /var/lib/netapp/cloudinsights/acq/download pour datasources.war et vérifiez le fichier zip qui s'y trouve :

. Vous devez passer à (ou vous déconnecter de root et vous connecter avec) l'utilisateur personnalisé pour les étapes suivantes.
+
 su <custom user>
+
Remarque : si vous utilisez l’utilisateur et le groupe « cisys » par défaut, vous n’avez pas besoin d’effectuer cette étape.

+
Remarque : l’utilisateur personnalisé peut être n’importe quel utilisateur membre d’un groupe personnalisé que vous avez fourni à cloudinsights-install.sh lors de l’installation d’AU, et peut être identique ou différent de l’utilisateur personnalisé que vous avez fourni lors de l’installation d’AU.

. Procédez comme suit :
+
....
chmod 770 /var/lib/netapp/cloudinsights/acq/download/datasources-war-<version>.zip
ls -al /var/lib/netapp/cloudinsights/acq/download
…
drwxrwx--- 2 test-user2 test-group-1  4096 Feb 16 10:10 datasources-war-<version>.zip
…
....
+
Remarque : si vous utilisez l’utilisateur et le groupe « cisys », ceux-ci seront affichés dans la sortie ci-dessus.

+
Remarque : si vous prévoyez d'effectuer l'installation à l'aide de différents utilisateurs personnalisés, assurez-vous que les autorisations de groupe sont définies en lecture et en écriture pour le propriétaire et le groupe (chmod 660…)

. Redémarrez la AU. Dans Data Infrastructure Insights, accédez à Observabilité > Collecteurs et sélectionnez l’onglet Unités d’acquisition.  Choisissez Redémarrer dans le menu « trois points » à droite de l’AU.




== Téléchargement d'un patch

Téléchargez le patch en utilisant l'API /collector/patch/file/{version} :

image:API_Manual_Download_patch.png["API pour récupérer le patch"]

Remarque : confirmez auprès de NetApp la version à spécifier pour le téléchargement.

Cliquez sur Télécharger le fichier.  Si vous effectuez ces étapes sur un système autre que le système AU, copiez le pack zip de correctifs téléchargé sur le système AU.

Assurez-vous que le fichier zip du correctif est copié dans le répertoire suivant : /var/lib/netapp/cloudinsights/acq/download

Accédez au répertoire /var/lib/netapp/cloudinsights/acq/download pour le correctif et vérifiez le fichier .zip qui s'y trouve :

. Vous devez passer à (ou vous déconnecter de root et vous connecter avec) l'utilisateur personnalisé pour les étapes suivantes.
+
 su <custom user>
+
Remarque : si vous utilisez l’utilisateur et le groupe « cisys » par défaut, vous n’avez pas besoin d’effectuer cette étape.

+
Remarque : l’utilisateur personnalisé peut être n’importe quel utilisateur membre d’un groupe personnalisé que vous avez fourni à cloudinsights-install.sh lors de l’installation d’AU, et peut être identique ou différent de l’utilisateur personnalisé que vous avez fourni lors de l’installation d’AU.

. Procédez comme suit :
+
....
chmod 770 /var/lib/netapp/cloudinsights/acq/download/<patch_file_name>.zip
ls -al /var/lib/netapp/cloudinsights/acq/download
…
drwxrwx--- 2 test-user2 test-group-1  4096 Feb 16 10:10 <patch_file_name>.zip
…
....
+
Remarque : si vous utilisez l’utilisateur et le groupe « cisys », ceux-ci seront affichés dans la sortie ci-dessus.

+
Remarque : si vous prévoyez d'effectuer l'installation à l'aide de différents utilisateurs personnalisés, assurez-vous que les autorisations de groupe sont définies en lecture et en écriture pour le propriétaire et le groupe (chmod 660…)

. Redémarrez la AU. Dans Data Infrastructure Insights, accédez à Observabilité > Collecteurs et sélectionnez l’onglet Unités d’acquisition.  Choisissez Redémarrer dans le menu « trois points » à droite de l’AU.




== Récupération de clés externes

Si vous fournissez un script shell UNIX, il peut être exécuté par l'unité d'acquisition pour récupérer la *clé privée* et la *clé publique* de votre système de gestion de clés.

Pour récupérer la clé, Data Infrastructure Insights exécutera le script en transmettant deux paramètres : _key id_ et _key type_.  _Key id_ peut être utilisé pour identifier la clé dans votre système de gestion de clés.  _Le type de clé_ est soit « public » soit « privé ».  Lorsque le type de clé est « public », le script doit renvoyer la clé publique.  Lorsque le type de clé est « privé », la clé privée doit être renvoyée.

Pour renvoyer la clé à l'unité d'acquisition, le script doit imprimer la clé sur la sortie standard.  Le script doit imprimer _uniquement_ la clé sur la sortie standard ; aucun autre texte ne doit être imprimé sur la sortie standard.  Une fois la clé demandée imprimée sur la sortie standard, le script doit quitter avec un code de sortie de 0 ; tout autre code de retour est considéré comme une erreur.

Le script doit être enregistré auprès de l'unité d'acquisition à l'aide de l'outil SecurityAdmin, qui exécutera le script avec l'unité d'acquisition.  Le script doit avoir les autorisations _read_ et _execute_ pour l'utilisateur root et "cisys".  Si le script shell est modifié après l'enregistrement, le script shell modifié doit être réenregistré auprès de l'unité d'acquisition.

|===


| paramètre d'entrée : identifiant de clé | Identificateur de clé utilisé pour identifier la clé dans le système de gestion des clés des clients. 


| paramètre d'entrée : type de clé | public ou privé. 


| sortir | La clé demandée doit être imprimée sur la sortie standard.  La clé RSA 2048 bits est actuellement prise en charge.  Les clés doivent être codées et imprimées au format suivant : format de clé privée - PEM, codé DER PKCS8 PrivateKeyInfo RFC 5958 format de clé publique - PEM, codé DER X.509 SubjectPublicKeyInfo RFC 5280 


| code de sortie | Code de sortie zéro en cas de réussite.  Toutes les autres valeurs de sortie sont considérées comme un échec. 


| autorisations de script | Le script doit avoir l'autorisation de lecture et d'exécution pour l'utilisateur root et « cisys ». 


| journaux | Les exécutions de scripts sont enregistrées.  Les journaux peuvent être trouvés dans - /var/log/netapp/cloudinsights/securityadmin/securityadmin.log /var/log/netapp/cloudinsights/acq/acq.log 
|===